<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buffered Voronoi Cell Collision Avoidance Demo</title>
  <link rel="stylesheet" href="stylesheets/styles.css">
</head>
<style>
</style>
<body>
  <svg width="1400" height="600"></svg>
  <!-- <label id="mouse-pos"></label> -->
  <label id="distance"></label>
  <div class="options">
    <div class="ui-section">
      <label class="key">Unique Collisions:</label>
      <input type="text" class="input-text input" id="unique-collisions" disabled>
    </div>
    <div class="ui-section">
      <label class="key">Total Collisions-Time Instances:</label>
      <input type="text" class="input-text input" id="total-collisions" disabled>
    </div>
    <div class="ui-section">
      <label class="key">Timescale:</label>
      <input type="range" min="0.0001" max="10.0" value=".005" step="0.001" class="slider input" id="time-scale-slider">
    </div>
    <div class="ui-section">
      <label class="key">Robots:</label>
      <input type="range" min="2" max="50" value="10" step="1" class="slider input" id="robots-slider">
    </div>
    <div class="ui-section">
      <label class="key">Pause and Reset:</label>
      <input type="button" value="Pause" class="input-button input half-btn" id="reset-button" onclick="pauseSimulation()">
      <input type="button" value="Reset" class="input-button input half-btn" id="reset-button" onclick="resetSimulation()">
    </div>
    <div class="ui-section">
      <label class="key">Show:</label>
      <input type="button" value="Robots" class="input-button input small-btn active" id="robot-button" onclick="visualizeElementsChanged()">
      <input type="button" value="Goals" class="input-button input small-btn active" id="goal-button" onclick="visualizeElementsChanged()">
      <input type="button" value="Temp Goals" class="input-button input small-btn active" id="tempGoal-button" onclick="visualizeElementsChanged()">
      <input type="button" value="VC" class="input-button input small-btn active" id="vc-button" onclick="visualizeElementsChanged()">
      <input type="button" value="BVC" class="input-button input small-btn active" id="bvc-button" onclick="visualizeElementsChanged()">
    </div>
    <div class="ui-section">
      <label class="key">Montion Planning Algorithm:</label>
      <select class="input-select input" id="algorithm-select" name="algorithms">
        <!-- <option value="0">Random</option> -->
        <option value="1">None (Straight To Goal)</option>
        <!-- <option value="2">Voronoi Cell</option> -->
        <option value="3" selected>Buffered Voronoi Cell</option>
      </select>
    </div>
    <div class="ui-section">
      <label class="key">Deadlock Recovery:</label>
      <select class="input-select input" id="deadlock-select" name="deadlock" onchange="changeDeadlockAlgorithm()">
        <!-- <option value="0">Random</option> -->
        <option value="0" selected>None</option>
        <option value="1">Basic</option>
        <option value="2" >Enhanced</option>
      </select>
    </div>
  </div>

  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="libraries/d3-delaunay.js"></script>
  <script src="libraries/offset.js"></script>
  <script src="scripts/geometry.js"></script>
  <script src="scripts/renderer.js"></script>
  <script src="scripts/scene.js"></script>
  <script src="scripts/robot.js"></script>
</body>
</html>

<!DOCTYPE html>
<meta charset="utf-8">
<script>
  
var timeInstance = 0;

// Setup
var activeElements = {Robots:1, Goals:1, TempGoals:1, VC:1, BVC:1};
var paused = false;
var numberOfRobots = 2;
var radiusOfRobots = 10;
var svg = d3.select("svg");
let motionPlanningAlgorithm = parseInt(document.getElementById("algorithm-select").value);
var gScene = new Scene(svg, numberOfRobots, radiusOfRobots, motionPlanningAlgorithm);

var resetSimulation = function(){
  timeInstance = 0;
  svg.selectAll("*").remove();
  motionPlanningAlgorithm = parseInt(document.getElementById("algorithm-select").value);
  gScene = new Scene(svg, numberOfRobots, radiusOfRobots, motionPlanningAlgorithm);
  changeDeadlockAlgorithm();
}

var changeDeadlockAlgorithm = function(){
  let deadlockAlgorithm = parseInt(document.getElementById("deadlock-select").value);
  gScene.robots.forEach(r => {
    r.setDeadlockAlgo(deadlockAlgorithm);
  });
}

var pauseSimulation= function(){
  paused = !paused;
}

svg.on('mousemove', function() {
      // document.getElementById("mouse-pos").textContent = d3.mouse(this);
});

var visualizeElementsChanged = function(){  
  document.getElementById(event.srcElement.id).classList.toggle("active");
  activeElements = { Robots:elementActive("robot-button"), 
                    Goals:elementActive("goal-button"), 
                    TempGoals:elementActive("tempGoal-button"), 
                    VC:elementActive("vc-button"), 
                    BVC:elementActive("bvc-button")};
}

var elementActive = function(id){
  return document.getElementById(id).classList.contains("active");
}

var renderScene = function(){
  if(!paused){
    gScene.update(activeElements);  
  }

  numberOfRobots = document.getElementById("robots-slider").value;
  gScene.setTimeScale(document.getElementById("time-scale-slider").value);
  document.getElementById("unique-collisions").value = gScene.uniqueCollisions.length;
  document.getElementById("total-collisions").value = gScene.totalCollisionTimeInst;
  document.getElementById("distance").textContent = Math.floor(gScene.distance) ;

  requestAnimationFrame(renderScene);
}

changeDeadlockAlgorithm();
renderScene();

</script>
